<VirtualHost *:80>
    ServerName guardianforge.com
    ServerAlias www.guardianforge.com dev.guardianforge.com
    DocumentRoot /home/guardianforge.com/www

    <Directory "/home/guardianforge.com">
        Require all granted
    </Directory>

    <Directory "/home/guardianforge.com/www">
        AllowOverride All
    </Directory>

    ErrorLog /home/logs/error_log
    CustomLog /home/logs/access_log common
    CustomLog /home/logs/referer_log referer
    CustomLog /home/logs/combined_log combined

    <IfModule mod_rewrite.c>
        RewriteEngine on
        RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
    </IfModule>
</VirtualHost>

<VirtualHost *:443>
    ServerName guardianforge.com
    ServerAlias www.guardianforge.com dev.guardianforge.com

    DocumentRoot /home/guardianforge.com/www
    Options -Indexes

    <Directory "/home/guardianforge.com">
        Require all granted
    </Directory>

    <Directory "/home/guardianforge.com/www">
        AllowOverride All
    </Directory>

    ErrorLog /home/logs/guardianforge.com/error_log
    CustomLog /home/logs/guardianforge.com/access_log common
    CustomLog /home/logs/guardianforge.com/referer_log referer
    CustomLog /home/logs/guardianforge.com/combined_log combined

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/guardianforge.com-0002/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/guardianforge.com-0002/privkey.pem

    <IfModule mod_rewrite.c>
        RewriteEngine on

        ## Redirect www and dev to non www
        RewriteCond %{HTTP_HOST} ^(dev|www)\.guardianforge\.com [NC]
        RewriteRule ^(.*) https://guardianforge.com$1 [L,R=301]
    </IfModule>

    <IfModule mod_headers.c>
        ## Cache resources for one year
        <FilesMatch "\.(ico|pdf|flv|gif|jpg|jpeg|png|gif|js|css|svg|woff|woff2|ttf|eot|webp)$">
            Header set Cache-control "max-age=30758400"
        </FilesMatch>
    </IfModule>
</VirtualHost>